<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.3 at Oct 30, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Meccano - </title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20121030" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                                      <a href="index.html" id="bannerLeft">
                                                <img src="images/meccano.png" alt="Meccano" title="ask for copyright to Meccano inc" />
                </a>
                          <div id="bannerRight">
                Modular Servlet Applications
                </div>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
            
                <div class="xleft">
        <span id="publishDate">Last Published: 2012-10-30</span>
                  &nbsp;| <span id="projectVersion">Version: 1.0</span>
                      </div>
            <div class="xright">                    <a href="https://github.com/turiot/meccano" class="externalLink" title="Github">Github</a>
            |
                        <a href="http://java.orfanik.com/" class="externalLink" title="Blog">Blog</a>
            |
                        <a href="http://www.meccano.com/la-marque/histoire.html" class="externalLink" title="Tribute">Tribute</a>
              
            
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
            
                                <h5>Meccano</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Purpose">Purpose</a>
            </li>
                  <li class="none">
            <strong>Technic</strong>
          </li>
                                                                                                        <li class="collapsed">
                          <a href="examples.html" title="Examples">Examples</a>
                  </li>
                  <li class="none">
                          <a href="handson.html" title="Hands on">Hands on</a>
            </li>
                  <li class="none">
                          <a href="todo.html" title="Todo">Todo</a>
            </li>
                  <li class="none">
                          <a href="afterword.html" title="Afterword">Afterword</a>
            </li>
          </ul>
                       <h5>Modules</h5>
                  <ul>
                  <li class="none">
                          <a href="bridge-core/index.html" title="bridge core">bridge core</a>
            </li>
                  <li class="none">
                          <a href="bridge-tomcat/index.html" title="bridge tomcat">bridge tomcat</a>
            </li>
                  <li class="none">
                          <a href="bridge-web/index.html" title="bridge web">bridge web</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
            
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        
  
  
    
    <div class="section"><h2>Problems<a name="Problems"></a></h2>
      <p>
        Storing services instances in a registry and access them with a Service Locator is a well know pattern, but in the servlet case we face 3 problems :
      </p>
      <ul>
        <li>
          Class loader isolation (wich is an specification for the servlet container)
        </li>
        <li>
          Synchronisation : the order the applications start is not deterministic
        </li>
        <li>
          Sharing singleton registries in a non instrusive way
        </li>
      </ul>
    </div>
    
    <div class="section"><h2>Solutions<a name="Solutions"></a></h2>
      <div class="section"><h3>Classloader hierarchy interception<a name="Classloader_hierarchy_interception"></a></h3>
        <p>
          Each api is registered as a new classloader in the registery.
          The applications classloader adds a lookup in this classloader before proceeding the normal lookup (webapp then shared).
        </p>
      </div>
        
      <div class="section"><h3>Asynchronous listeners<a name="Asynchronous_listeners"></a></h3>
        <p>
          In order to wait for dependant parts, the application start launches a thread waiting for components.
          A sequence of optional commands is executed : wait for the bridge, wait for api's appearing in the api registry, wait for services in the service
          registry, adding api's in the registry, adding services.
          Parts become available as the sequence goes along.
          At the end a status is set, opening access to the application is every steps ran fine.
        </p>
      </div>
        
      <div class="section"><h3>MBean server<a name="MBean_server"></a></h3>
        <p>
          Instead of putting registries in the shared Tomcat path, wich suppose access to the configuration, an application (the bridge) does this 
          job, giving registries availables to other parts.
          The Tomcat MBean server is used, via a status MBean to notify dependant applications that the bridge (the singleton registries in fact)
          is set.
        </p>
      </div>
    </div>
    
    <div class="section"><h2>Implementation<a name="Implementation"></a></h2>
      <p>
        <b>Component view :</b>
      </p>
      <img src="./images/comp.png" alt="Component" /></img>
      <p>
        Core module brings registries (lazy singletons) via web wrapper;<br />
        Tomcat module setup custom asynchronous listener (with commands) and CompositeLoder;<br />
        A final application is mainly business classes and configuration (cf examples).
      </p>
      <p>
        <b>Class view :</b>
      </p>
      <img src="./images/classes.png" alt="Classes" /></img>
      <p>
        Not illustrated here are the web context to store status and so on, and the MBean server used by BridgeStatus and WaitBridgeCommand.<br />
        The CompositeLoader is inserted before WebappLoader to lookup in api registry before normal lookup.
      </p>
      <p>
        <b>Activity view :</b>
      </p>
      <img src="./images/act.png" alt="Activity" /></img>
      <p>
        The commands sequence ensure synchronisation.
      </p>
      <p>
        <b>Sequence diagrams :</b>
      </p>
      <img src="./images/seq2.png" alt="Sequence2" /></img>
      <img src="./images/seq.png" alt="Sequence" /></img>
      <p>
        An executor is used to ease the shutdown of a failed application and for a future server level management
      </p>
    </div>
    
    <div class="section"><h2>Notes<a name="Notes"></a></h2>
      <p>
        We can't use JNDI + transloader (http://code.google.com/p/transloader/) as Tomcat's JNDI is read only; neither common libs as they can't be dynamically refreshed.
      </p>
      <p>
        The code is intentionally 1.5 compatible and could be more elegant using 1.7 features.
      </p>
    </div>
  
  

      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              <?xml version="1.0" encoding="UTF-8"?>
<footer></footer>
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
